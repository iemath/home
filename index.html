<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trung Tâm IEMATH</title>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --text-color: #2c3e50;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f5f7fa;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
        }

        h1 {
            margin: 0;
            font-size: 2.5rem;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-top: 10px;
        }

        nav {
            background-color: #fff;
            padding: 10px 0;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        nav ul li {
            display: inline;
        }

        nav ul li a {
            text-decoration: none;
            color: var(--primary-color);
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        nav ul li a:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .banner {
            background-color: #ffd700;
            color: var(--text-color);
            text-align: center;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .section {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
        }

        .section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-group input[required] {
            border-color: var(--primary-color);
        }

        .form-group button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .form-group button:hover {
            background-color: var(--secondary-color);
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0 auto;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .rank-1 {
            background-color: #ffd700;
            font-weight: bold;
        }

        .rank-2 {
            background-color: #c0c0c0;
            font-weight: bold;
        }

        .rank-3 {
            background-color: #cd7f32;
            font-weight: bold;
            color: white;
        }

        .honor-table {
            width: 100%;
            margin-top: 20px;
        }

        .honor-table th, .honor-table td {
            text-align: center;
        }

        .honor-table .icon {
            font-size: 1.5rem;
            margin-right: 5px;
        }

        .error-message {
            color: var(--danger-color);
            text-align: center;
            padding: 15px;
            border: 1px solid var(--danger-color);
            border-radius: var(--border-radius);
            margin: 20px 0;
            background-color: #fdecea;
        }

        @media (max-width: 768px) {
            th, td {
                padding: 8px 10px;
                font-size: 0.9rem;
            }
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>TRUNG TÂM IEMATH</h1>
            <div class="subtitle">Học tập - Phát triển - Thành công</div>
        </header>

        <nav>
            <ul>
                <li><a href="#register" onclick="showSection('register')">Đăng ký học</a></li>
                <li><a href="#scores" onclick="showSection('scores')">Bảng điểm học sinh</a></li>
                <li><a href="#competition" onclick="showSection('competition')">Kết quả thi đua</a></li>
            </ul>
        </nav>

        <div class="banner">
            Vinh danh học sinh xuất sắc năm, tháng, tuần
        </div>

        <div class="section active" id="home">
            <h2>Bảng vinh danh học sinh</h2>
            <div class="table-container" id="honorTable">
                <!-- Bảng vinh danh sẽ được thêm vào đây -->
            </div>
        </div>

        <div class="section" id="register">
            <h2>Đăng ký học</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label for="studentName">Tên học sinh <span style="color: red;">*</span></label>
                    <input type="text" id="studentName" required>
                </div>
                <div class="form-group">
                    <label for="parentName">Tên phụ huynh</label>
                    <input type="text" id="parentName">
                </div>
                <div class="form-group">
                    <label for="class">Lớp</label>
                    <select id="class">
                        <option value="">Chọn lớp</option>
                        <option value="6">Lớp 6</option>
                        <option value="7">Lớp 7</option>
                        <option value="8">Lớp 8</option>
                        <option value="9">Lớp 9</option>
                        <option value="10">Lớp 10</option>
                        <option value="11">Lớp 11</option>
                        <option value="12">Lớp 12</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="subject">Môn học</label>
                    <input type="text" id="subject">
                </div>
                <div class="form-group">
                    <label for="school">Trường</label>
                    <input type="text" id="school">
                </div>
                <div class="form-group">
                    <label for="address">Địa chỉ</label>
                    <input type="text" id="address">
                </div>
                <div class="form-group">
                    <label for="phone">Số điện thoại liên hệ <span style="color: red;">*</span></label>
                    <input type="tel" id="phone" required>
                </div>
                <div class="form-group">
                    <label for="social">Zalo/Facebook</label>
                    <input type="text" id="social">
                </div>
                <div class="form-group">
                    <button type="submit">Đăng ký</button>
                </div>
            </form>
        </div>

        <div class="section" id="scores">
            <h2>Bảng điểm học sinh</h2>
            <div class="form-group">
                <label for="scoreCode">Nhập mã để xem bảng điểm</label>
                <input type="text" id="scoreCode" placeholder="Ví dụ: HSLH07">
                <button onclick="loadScores()">Xem</button>
            </div>
            <div id="scoreError" class="error-message" style="display: none;"></div>
            <div class="table-container" id="scoreTable">
                <!-- Bảng điểm sẽ được thêm vào đây -->
            </div>
        </div>

        <div class="section" id="competition">
            <h2>Kết quả thi đua</h2>
            <div class="form-group">
                <label for="competitionCode">Nhập mã để xem kết quả thi đua</label>
                <input type="text" id="competitionCode" placeholder="Ví dụ: HST07">
                <button onclick="loadCompetition()">Xem</button>
            </div>
            <div id="competitionError" class="error-message" style="display: none;"></div>
            <div class="table-container" id="competitionTable">
                <!-- Bảng kết quả thi đua sẽ được thêm vào đây -->
            </div>
        </div>
    </div>

    <script>
        // Hiển thị section
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            if (sectionId === 'home') {
                loadHonorTable();
            }
        }

        // Xử lý form đăng ký
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Đăng ký thành công! Chúng tôi sẽ liên hệ với bạn sớm.');
            this.reset();
        });

        // Link Google Sheets
        const permissionUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSPc7GnPYkbFV1m383rpowhCFZpue-n6gn93toLmlT3zg-Oge7s_YoC5PSxI1iHNhViSpaQlIVMKTnk/pub?gid=0&output=csv';
        const scoresUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSPc7GnPYkbFV1m383rpowhCFZpue-n6gn93toLmlT3zg-Oge7s_YoC5PSxI1iHNhViSpaQlIVMKTnk/pub?gid=1&output=csv';
        const competitionUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSPc7GnPYkbFV1m383rpowhCFZpue-n6gn93toLmlT3zg-Oge7s_YoC5PSxI1iHNhViSpaQlIVMKTnk/pub?gid=2&output=csv';
        const honorUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSPc7GnPYkbFV1m383rpowhCFZpue-n6gn93toLmlT3zg-Oge7s_YoC5PSxI1iHNhViSpaQlIVMKTnk/pub?gid=3&output=csv';

        // Hàm chuyển đổi CSV sang mảng
        function csvToArray(csvText) {
            const lines = csvText.split('\n');
            const result = [];
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                const currentline = lines[i].split(',');
                result.push(currentline);
            }
            return result;
        }

        // Hàm tạo bảng
        function createTable(data, rankColumnIndex = -1) {
            const table = document.createElement('table');
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            data[0].forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            for (let i = 1; i < data.length; i++) {
                const row = document.createElement('tr');
                data[i].forEach((cell, index) => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    row.appendChild(td);
                });
                if (rankColumnIndex !== -1 && data[i][rankColumnIndex]) {
                    const rank = parseInt(data[i][rankColumnIndex]);
                    if (!isNaN(rank)) {
                        if (rank === 1) row.classList.add('rank-1');
                        else if (rank === 2) row.classList.add('rank-2');
                        else if (rank === 3) row.classList.add('rank-3');
                    }
                }
                tbody.appendChild(row);
            }
            table.appendChild(tbody);
            return table;
        }

        // Hàm tạo bảng vinh danh
        function createHonorTable(data) {
            const table = document.createElement('table');
            table.className = 'honor-table';
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            ['Tên', 'Lớp', 'Xếp hạng', 'Thành tích'].forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            for (let i = 1; i < Math.min(data.length, 11); i++) { // Lấy tối đa 10 học sinh
                const row = document.createElement('tr');
                const rank = parseInt(data[i][2]);
                let icon = '';
                if (rank === 1) {
                    icon = '<i class="fas fa-trophy icon" style="color: #ffd700;"></i>';
                    row.classList.add('rank-1');
                } else if (rank === 2) {
                    icon = '<i class="fas fa-trophy icon" style="color: #c0c0c0;"></i>';
                    row.classList.add('rank-2');
                } else if (rank === 3) {
                    icon = '<i class="fas fa-trophy icon" style="color: #cd7f32;"></i>';
                    row.classList.add('rank-3');
                }
                row.innerHTML = `
                    <td>${data[i][0]}</td>
                    <td>${data[i][1]}</td>
                    <td>${icon}${data[i][2]}</td>
                    <td>${data[i][3]}</td>
                `;
                tbody.appendChild(row);
            }
            table.appendChild(tbody);
            return table;
        }

        // Hàm tải bảng vinh danh
        async function loadHonorTable() {
            try {
                const response = await fetch(honorUrl);
                if (!response.ok) throw new Error('Không thể tải dữ liệu vinh danh');
                const csvText = await response.text();
                const data = csvToArray(csvText);
                const table = createHonorTable(data);
                document.getElementById('honorTable').innerHTML = '';
                document.getElementById('honorTable').appendChild(table);
            } catch (error) {
                document.getElementById('honorTable').innerHTML = `<div class="error-message">${error.message}</div>`;
            }
        }

        // Hàm kiểm tra mã phân quyền
        async function checkPermission(code, type) {
            const response = await fetch(permissionUrl);
            const csvText = await response.text();
            const data = csvToArray(csvText);
            for (let i = 1; i < data.length; i++) {
                if (data[i][0] === code && data[i][2] === type) {
                    return data[i][1]; // Trả về tên lớp
                }
            }
            return null;
        }

        // Hàm tải bảng điểm
        async function loadScores() {
            const code = document.getElementById('scoreCode').value;
            const errorElement = document.getElementById('scoreError');
            const tableElement = document.getElementById('scoreTable');
            errorElement.style.display = 'none';
            tableElement.innerHTML = '';

            try {
                const className = await checkPermission(code, 'Bảng điểm');
                if (!className) {
                    errorElement.textContent = 'Mã không hợp lệ hoặc không có quyền xem bảng điểm này.';
                    errorElement.style.display = 'block';
                    return;
                }

                const response = await fetch(scoresUrl);
                if (!response.ok) throw new Error('Không thể tải dữ liệu bảng điểm');
                const csvText = await response.text();
                const data = csvToArray(csvText);
                const filteredData = [data[0]]; // Giữ hàng tiêu đề
                for (let i = 1; i < data.length; i++) {
                    if (data[i][2] === className) {
                        filteredData.push(data[i]);
                    }
                }
                if (filteredData.length === 1) {
                    errorElement.textContent = 'Không có dữ liệu cho lớp này.';
                    errorElement.style.display = 'block';
                    return;
                }
                const table = createTable(filteredData);
                tableElement.appendChild(table);
            } catch (error) {
                errorElement.textContent = error.message;
                errorElement.style.display = 'block';
            }
        }

        // Hàm tải kết quả thi đua
        async function loadCompetition() {
            const code = document.getElementById('competitionCode').value;
            const errorElement = document.getElementById('competitionError');
            const tableElement = document.getElementById('competitionTable');
            errorElement.style.display = 'none';
            tableElement.innerHTML = '';

            try {
                const className = await checkPermission(code, 'Kết quả thi đua');
                if (!className) {
                    errorElement.textContent = 'Mã không hợp lệ hoặc không có quyền xem kết quả thi đua này.';
                    errorElement.style.display = 'block';
                    return;
                }

                const response = await fetch(competitionUrl);
                if (!response.ok) throw new Error('Không thể tải dữ liệu kết quả thi đua');
                const csvText = await response.text();
                const data = csvToArray(csvText);
                const filteredData = [data[0]]; // Giữ hàng tiêu đề
                for (let i = 1; i < data.length; i++) {
                    if (data[i][2] === className) {
                        filteredData.push(data[i]);
                    }
                }
                if (filteredData.length === 1) {
                    errorElement.textContent = 'Không có dữ liệu cho lớp này.';
                    errorElement.style.display = 'block';
                    return;
                }
                const table = createTable(filteredData, 4); // Cột Xếp hạng là cột thứ 5 (chỉ số 4)
                tableElement.appendChild(table);
            } catch (error) {
                errorElement.textContent = error.message;
                errorElement.style.display = 'block';
            }
        }

        // Tải bảng vinh danh khi trang được tải
        loadHonorTable();
    </script>
</body>
</html>